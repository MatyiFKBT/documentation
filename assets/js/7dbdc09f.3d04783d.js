"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[7536],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>h});var n=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(o),h=r,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||a;return o?n.createElement(m,i(i({ref:t},u),{},{components:o})):n.createElement(m,i({ref:t},u))}));function h(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=o.length,i=new Array(a);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<a;p++)i[p]=o[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}c.displayName="MDXCreateElement"},76678:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var n=o(87462),r=(o(67294),o(3905));const a={slug:"turborepo-overhyped",title:"Is Turborepo overhyped?",description:"What is Turborepo and why do we need it? Turoberpo is quite minimalistic and simple to use solution how to speed up pipeline in monorepo.",authors:["sgranat"],image:"/img/blog/turborepo.png",tags:["react","javascript","typescript","integration"]},i=void 0,s={permalink:"/blog/turborepo-overhyped",editUrl:"https://github.com/tolgee/documentation/tree/main/blog/2022-02-08-turborepo-overhyped.md",source:"@site/blog/2022-02-08-turborepo-overhyped.md",title:"Is Turborepo overhyped?",description:"What is Turborepo and why do we need it? Turoberpo is quite minimalistic and simple to use solution how to speed up pipeline in monorepo.",date:"2022-02-08T00:00:00.000Z",formattedDate:"February 8, 2022",tags:[{label:"react",permalink:"/blog/tags/react"},{label:"javascript",permalink:"/blog/tags/javascript"},{label:"typescript",permalink:"/blog/tags/typescript"},{label:"integration",permalink:"/blog/tags/integration"}],readingTime:5.12,hasTruncateMarker:!0,authors:[{name:"\u0160t\u011bp\xe1n Gran\xe1t",title:"Frontend Architect",url:"https://github.com/stepan662",imageURL:"https://avatars.githubusercontent.com/u/8831144?v=4",key:"sgranat"}],frontMatter:{slug:"turborepo-overhyped",title:"Is Turborepo overhyped?",description:"What is Turborepo and why do we need it? Turoberpo is quite minimalistic and simple to use solution how to speed up pipeline in monorepo.",authors:["sgranat"],image:"/img/blog/turborepo.png",tags:["react","javascript","typescript","integration"]},prevItem:{title:"Optimizing Spring Boot tests",permalink:"/blog/optimizing-spring-boot-tests"},nextItem:{title:"Moving project from YouTrack to GitHub",permalink:"/blog/moving-project-from-youtrack-to-github"}},l={authorsImageUrls:[void 0]},p=[{value:"What exactly is Turborepo and why do we need it?",id:"what-exactly-is-turborepo-and-why-do-we-need-it",level:2},{value:"Setting up",id:"setting-up",level:2},{value:"Where the real issues started",id:"where-the-real-issues-started",level:2},{value:"Maybe I made a mistake",id:"maybe-i-made-a-mistake",level:2},{value:"Or not?",id:"or-not",level:3},{value:"My conclusion",id:"my-conclusion",level:2}],u={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Turborepo",src:o(35879).Z,width:"1000",height:"420"})),(0,r.kt)("p",null,"Two months ago, I was looking for a solution how to speed up pipeline in our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tolgee/tolgee-js"},"monorepo"),". As an immediate answer I found basically two alternatives ",(0,r.kt)("a",{parentName:"p",href:"https://nx.dev/"},"Nx")," (from Google) and ",(0,r.kt)("a",{parentName:"p",href:"https://turborepo.org/"},"Turborepo")," as a new cool project from well known opensource author (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/jaredpalmer"},"Jared Palmer"),"). I was immediately drawn towards Turborepo as it was really hyped everywhere. Also, it is quite minimalistic, simple to use and it looked like exact fit for our use-case. So I got into it."),(0,r.kt)("h2",{id:"what-exactly-is-turborepo-and-why-do-we-need-it"},"What exactly is Turborepo and why do we need it?"),(0,r.kt)("p",null,"Turborepo is a build system for monorepos (multiple projects in one repository). We use monorepo in Tolgee, because we have multiple SDKs for different frameworks as separate NPM packages and it is very convenient to test and release them together, so monorepo is an ideal fit."),(0,r.kt)("p",null,"As with every monorepo we struggle to keep our building and testing pipeline fast. Turborepo is designed for this. Simply put, it keeps a cache of previous builds for each individual project (workspace) and if nothing changed in that project, it will just use the cache instead of rebuilding. It also automatically detects dependencies between the projects so it knows that if the dependency of one project changed that project needs to be rebuilt too."),(0,r.kt)("p",null,"It can be also used for testing as you can only run tests in projects which are affected by changes and it treats standard output as part of a cache so even if some test don't run Turborepo will output cached logs, so you see all the test results every time."),(0,r.kt)("p",null,"It is also able to run multiple commands in parallel, which is ideal for development when you need to watch code changes and rebuild on the fly."),(0,r.kt)("h2",{id:"setting-up"},"Setting up"),(0,r.kt)("p",null,'I was able to understand Turborepo docs quite quickly (as it\'s really short so far :D). It took me a bit of trial and error to set everything up correctly as I needed to wrap my head around how exactly the caching works. I recommend spending some time experimenting with changes in different projects and checking if it works correctly as it takes some time to wrap around your brain. However, in the end, it is very satisfying, when you see colorful label "FULL TURBO", when everything is taken from cache and no real build is necessary. '),(0,r.kt)("p",null,"One little caveat was that we are using lerna, which has it's own definition for workspaces, however Turborepo requires the definition to be in ",(0,r.kt)("inlineCode",{parentName:"p"},"package.json"),", which causes issues with ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install")," command as npm now also supports workspaces, but is installing dependencies differently than we need. I didn't find a simple way how to get around this issue so at the end I use custom command for module installation, which first removes workspaces from root package.json, then performs all the installations with lerna and then returns the package.json to original state, not ideal but managable."),(0,r.kt)("h2",{id:"where-the-real-issues-started"},"Where the real issues started"),(0,r.kt)("p",null,"During my experiments I've noticed that sometimes not all dependant projects are rebuild as they should be. I found already reported issue about it and amazingly the next day it was fixed. Wow. I wanned to upgrade to next version but wait ... that's weird some error appeared during an installation."),(0,r.kt)("p",null,"Hmm, I found another reported error - it seems like it's broken when you install it with npm (yarn and pnpm works), that's unfortunate \ud83d\ude14. Luckily it was fixed in about 4 hours, so now everything worked fine and I've prepared and tested everything and submitted it for a review. However, my colleague writes me back in two hours that the process it hitting his CPU running on 100% (one core) and his machine is constantly overheating even when he's in development mode and not making any changes to the code! Another issue (already existing on GitHub), Agh!!"),(0,r.kt)("p",null,"Even when the issue was fixed the next day, I wasn't really that confident about Turborepo as even though it was in version 1.0.xx it seemed more like beta or alpha version. However, now everything worked so PR was merged."),(0,r.kt)("p",null,"A few hours later I've noticed a weird thing. All our available GitHub runners were busy and I was not able to run a new task. It turned out that when some build failed Turborepo didn't finish the process but it was stuck and ran forewer. I had to manually stop all CI pipelines and roll back the release as this was a major problem."),(0,r.kt)("h2",{id:"maybe-i-made-a-mistake"},"Maybe I made a mistake"),(0,r.kt)("p",null,"Hmm, seems like Turborepo is not in production-ready state. I was really pissed as I've already spent about 4 days with this and now I'm back where I was at the beginning. I've tried to switch to Nx, but compared to the Turborepo setup, everything was much more complicated - it has all the functions we need, but it's really blown and not elegant at all."),(0,r.kt)("h3",{id:"or-not"},"Or not?"),(0,r.kt)("p",null,"I've let everything as it was and let the PR open for one month. Now I've returned to it and Turborepo is in version 1.1.xx and everything seems to work as expected. Ok, our pipeline is much faster and we now have much more elegant way how to run dev mode locally. However I still better run our main release pipeline without any caching as I want to be sure that something is not getting cached when it shouldn't be as that really could be a big problem and I know I that Turborepo can't be 100% trusted."),(0,r.kt)("h2",{id:"my-conclusion"},"My conclusion"),(0,r.kt)("p",null,"Turborepo is a really cool project. And it's not just cool, it's really necessary - there clearly was missing some tool like this as monorepos are more and more popular. Everyone was tweeting about using Turborepo is great and that it made his pipeline 10x faster, but nobody was mentioning these issues. I think that the hype around it caused me to use it prematurely and lose valuable time and in the and be bitter about it."),(0,r.kt)("p",null,"So, you know \ud83e\udd37\ud83c\udffb\u200d\u2642\ufe0f. Be careful about what is currently trending and don't let the shine blind you, when you are deciding what to use on production."))}d.isMDXComponent=!0},35879:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/turborepo-418e636fdcf4ba1882e878ee6b878a2a.png"}}]);